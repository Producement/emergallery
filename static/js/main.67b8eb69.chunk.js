(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{147:function(e,t){},149:function(e,t){},156:function(e,t,a){},158:function(e,t,a){},160:function(e,t,a){},166:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),i=a(27),l=a.n(i),s=a(7),o=a(8),r=a(11),m=a(10),d=a(12),u=a(2),h=a(154),v=a(66),p=n.createContext(null),f=function(e){return function(t){return n.createElement(p.Consumer,null,function(a){return n.createElement(e,Object.assign({},t,{firebase:a}))})}},g=p,b=a(24),E=a.n(b),N=(a(83),a(167),{apiKey:"AIzaSyC4dD0IMMqu17hY-2FmPTo7i21fsHKe2tA",authDomain:"g48riik.firebaseapp.com",databaseURL:"https://g48riik.firebaseio.com",projectId:"g48riik",storageBucket:"g48riik.appspot.com",messagingSenderId:"652593373917"}),k=function(){function e(){Object(s.a)(this,e),E.a.initializeApp(N)}return Object(o.a)(e,[{key:"firestore",value:function(){var e=E.a.firestore();return e.settings({timestampsInSnapshots:!0}),e}},{key:"storage",value:function(){return E.a.storage()}}]),e}(),w=a(68),y=a.n(w),j=a(39),O=a.n(j),x=a(21),S=a.n(x),I=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(m.a)(t).call(this,e))).liveVideo=null,a.screenshot=a.screenshot.bind(Object(u.a)(Object(u.a)(a))),a.init=a.init.bind(Object(u.a)(Object(u.a)(a))),a.state={playing:!1},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.liveVideo&&(this.liveVideo.onplay=function(){e.setState({playing:!0})}),this.init()}},{key:"init",value:function(){var e=this,t=this.props,a=t.firebase,n=t.match.params.id;console.log("Initialising peer");var c=new O.a;c.on("signal",function(e){console.log("Peer2 signal"),a.firestore().collection("peers").doc("".concat(n,"#1")).set({data:e})}),c.on("stream",function(t){console.log("Stream"),e.liveVideo&&(e.liveVideo.src=window.URL.createObjectURL(t),e.liveVideo.play())});var i=a.firestore().collection("peers").doc("".concat(n,"#2")).onSnapshot(function(e){if(e.data()){var t=e.data().data;t&&(console.log("Sending data"),c.signal(t))}});c.on("error",function(t){console.log("Closing peer2 ".concat(t)),i(),a.firestore().collection("peers").doc("".concat(n,"#1")).set({data:""}),e.init()}),c.on("close",console.log)}},{key:"screenshot",value:function(){var e=document.createElement("canvas");if(e){var t=this.liveVideo;e.width=t.clientWidth,e.height=t.clientHeight,e.getContext("2d").drawImage(t,0,0,e.width,e.height);var a=this.props,n=a.firebase,c=a.match.params.id,i=n.storage(),l=S()(),s=i.ref().child(l);e.toBlob(function(t){s.put(t).then(function(t){console.log("Saved file"),t.ref.getDownloadURL().then(function(t){console.log(t),n.firestore().collection("events").doc(c).collection("images").doc(l).set({width:e.width,height:e.height,src:t})})})})}}},{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"row text-center"},c.a.createElement("div",{className:"col"},!this.state.playing&&c.a.createElement("img",{key:"d",src:"https://www.echelonchicago.com/wp-content/uploads/2014/06/dummy.gif"}),c.a.createElement("video",{ref:function(t){e.liveVideo=t}}),this.state.playing&&c.a.createElement("div",{className:"row justify-content-center"},c.a.createElement("button",{className:"btn btn-primary btn-lg",onClick:this.screenshot},"Tee pilt"))))}}]),t}(c.a.Component),L=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(m.a)(t).call(this,e))).gotMedia=a.gotMedia.bind(Object(u.a)(Object(u.a)(a))),a.initiate=a.initiate.bind(Object(u.a)(Object(u.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"gotMedia",value:function(e){var t=this.props,a=t.firebase,n=t.match.params.id;console.log("Got media, initialising peer");var c=new O.a({initiator:!0,trickle:!1,stream:e});c.on("signal",function(e){console.log("Peer1 signal"),a.firestore().collection("peers").doc("".concat(n,"#2")).set({data:e})});var i=a.firestore().collection("peers").doc("".concat(n,"#1")).onSnapshot(function(e){if(e.data()){var t=e.data().data;t&&(console.log("Sending data"),c.signal(t))}});c.on("error",function(e){i(),console.log("Closing peer1 ".concat(e)),a.firestore().collection("peers").doc("".concat(n,"#2")).set({data:""})})}},{key:"initiate",value:function(){navigator.getUserMedia({video:!0,audio:!0},this.gotMedia,function(){})}},{key:"render",value:function(){return c.a.createElement("button",{className:"btn btn-primary btn-block btn-lg",onClick:this.initiate},"N\xc4ITA VIDEOT")}}]),t}(c.a.Component),C=Object(h.a)(f(L)),P=Object(h.a)(f(I)),D=(a(156),a(70)),T=a.n(D),B=a(34),H=a.n(B),M=a(31),U=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(m.a)(t).call(this,e))).state={currentImage:0},a.closeLightbox=a.closeLightbox.bind(Object(u.a)(Object(u.a)(a))),a.openLightbox=a.openLightbox.bind(Object(u.a)(Object(u.a)(a))),a.gotoNext=a.gotoNext.bind(Object(u.a)(Object(u.a)(a))),a.gotoPrevious=a.gotoPrevious.bind(Object(u.a)(Object(u.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"openLightbox",value:function(e,t){this.setState({currentImage:t.index,lightboxIsOpen:!0})}},{key:"closeLightbox",value:function(){this.setState({currentImage:0,lightboxIsOpen:!1})}},{key:"gotoPrevious",value:function(){this.setState({currentImage:this.state.currentImage-1})}},{key:"gotoNext",value:function(){this.setState({currentImage:this.state.currentImage+1})}},{key:"render",value:function(){return c.a.createElement("section",{id:"pildid"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-12"},c.a.createElement("div",{className:"title-box mb-3"},c.a.createElement("h3",{className:"fadeIn animated wow","data-wow-delay":".1s"},"\xdcleslaetud pildid"),c.a.createElement("div",{className:"border"})))),c.a.createElement(v.a,{photos:this.props.photos,onClick:this.openLightbox}),c.a.createElement(y.a,{images:this.props.photos,onClose:this.closeLightbox,onClickPrev:this.gotoPrevious,onClickNext:this.gotoNext,currentImage:this.state.currentImage,isOpen:this.state.lightboxIsOpen}))}}]),t}(n.Component),V=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(m.a)(t).call(this,e))).state={images:[],event:null},a.goBack=a.goBack.bind(Object(u.a)(Object(u.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"dummyImage",value:function(e){return{key:e,src:"https://www.echelonchicago.com/wp-content/uploads/2014/06/dummy.gif",width:500,height:271}}},{key:"componentDidMount",value:function(){var e=this,t=this.props.firebase.firestore().collection("events").doc(this.props.match.params.id);t.collection("images").onSnapshot(function(t){var a=[];t.forEach(function(e){a.push(e.data())});for(var n=0;a.length<4;)a.push(e.dummyImage(n++));e.setState({images:a,event:e.state.event})}),t.onSnapshot(function(t){e.setState({images:e.state.images,event:t.data()})})}},{key:"getLongitude",value:function(){if(this.state.event&&this.state.event.location)return this.state.event.location.longitude}},{key:"getLatitude",value:function(){if(this.state.event&&this.state.event.location)return this.state.event.location.latitude}},{key:"getAddress",value:function(){if(this.state.event&&this.state.event.address)return this.state.event.address}},{key:"getPhone",value:function(){if(this.state.event)return this.state.event.phoneNr}},{key:"goBack",value:function(){this.props.history.push("/")}},{key:"render",value:function(){return this.state.event&&this.state.event.startTime?c.a.createElement("div",{className:"container"},c.a.createElement("div",{className:"row profile"},c.a.createElement("div",{className:"col-md-3 sidebar"},c.a.createElement("div",{className:"sidebar-sticky"},c.a.createElement("div",{className:"main-section text-center"},c.a.createElement("div",{className:"profile-header"}),c.a.createElement("div",{className:"row user-detail"},c.a.createElement("div",{className:"col-lg-12 col-sm-12 col-12"},c.a.createElement("img",{src:T.a,className:"rounded-circle img-thumbnail"}),c.a.createElement("h5",null,c.a.createElement("i",{className:"fa fa-phone","aria-hidden":"true"})," ",this.getPhone()),c.a.createElement("p",null,c.a.createElement("i",{className:"fa fa-map-marker","aria-hidden":"true"})," ",this.getAddress()||"Ei ole saadaval"),c.a.createElement("hr",null),c.a.createElement("p",null,c.a.createElement("i",{className:"fa fa-compass","aria-hidden":"true"})," ",this.getLatitude()||"Ei ole saadaval"),c.a.createElement("p",null,c.a.createElement("i",{className:"fa fa-globe","aria-hidden":"true"})," ",this.getLongitude()||"Ei ole saadaval")))),c.a.createElement("div",{className:"profile-usermenu"},c.a.createElement("ul",{className:"nav flex-column"},c.a.createElement("li",{className:"nav-item"},c.a.createElement(M.HashLink,{className:"nav-link active",to:"#pildid"},c.a.createElement("i",{className:"fa fa-picture-o","aria-hidden":"true"}),"Pildid ",c.a.createElement("span",{className:"sr-only"},"(current)"))),c.a.createElement("li",{className:"nav-item"},c.a.createElement(M.HashLink,{className:"nav-link",to:"#video"},c.a.createElement("i",{className:"fa fa-video-camera","aria-hidden":"true"}),"Video")),c.a.createElement("li",{className:"nav-item"},c.a.createElement(M.HashLink,{className:"nav-link",to:"#waze"},c.a.createElement("i",{className:"fa fa-car","aria-hidden":"true"}),"Waze")),c.a.createElement("li",{className:"nav-item"},c.a.createElement(M.HashLink,{className:"nav-link",to:"#twitter"},c.a.createElement("i",{className:"fa fa-twitter","aria-hidden":"true"}),"Twitter")))))),c.a.createElement("div",{className:"col-md-9"},c.a.createElement("div",{className:"profile-content"},c.a.createElement("div",{className:"container"},this.state.images.length>0&&c.a.createElement(U,{photos:this.state.images}),c.a.createElement("section",{id:"video"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-12"},c.a.createElement("div",{className:"title-box mb-3 mt-5"},c.a.createElement("h3",{className:"fadeIn animated wow","data-wow-delay":".1s"},"Live video\xfclekanne"),c.a.createElement("div",{className:"border"})))),c.a.createElement(P,null)),this.getLatitude()&&this.getLongitude()&&c.a.createElement("div",null,c.a.createElement("section",{id:"waze"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-12"},c.a.createElement("div",{className:"title-box mb-3 mt-5"},c.a.createElement("h3",{className:"fadeIn animated wow","data-wow-delay":".1s"},"S\xfcndmused kaardil"),c.a.createElement("div",{className:"border"})))),c.a.createElement("div",{className:"embed-responsive embed-responsive-16by9"},c.a.createElement("iframe",{allowFullScreen:!0,frameBorder:"0",src:"https://embed.waze.com/iframe?zoom=15&lat=59.438698&lon=24.729117&ct=livemap"}))),c.a.createElement("section",{id:"twitter"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-12"},c.a.createElement("div",{className:"title-box mb-3 mt-5"},c.a.createElement("h3",{className:"fadeIn animated wow","data-wow-delay":".1s"},"S\xe4utsud kaardil"),c.a.createElement("div",{className:"border"})))),c.a.createElement("div",{className:"embed-responsive embed-responsive-16by9"},c.a.createElement("iframe",{allowFullScreen:!0,frameBorder:"0",src:"https://twimap.com/?embed=true&location=59.438698%2C24.729117&zoom=15&distance=500&count=100&min_timestamp=0&max_timestamp=0"})))))))),c.a.createElement("footer",{className:"section bg-gray footer"},c.a.createElement("div",{className:"container"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-12"},c.a.createElement("div",{className:"footer-alt"},c.a.createElement("div",{className:"float-left pull-none "},c.a.createElement("span",{className:"navbar-brand logo"},c.a.createElement("img",{src:H.a,alt:""})," ",c.a.createElement("span",null,"Producement"))),c.a.createElement("div",{className:"float-right pull-none "},c.a.createElement("p",{className:"pull-right text-muted m-b-0"},"2018 \xa9"," ",c.a.createElement("a",{href:"https://producement.com"},"Producement.com"))))))))):c.a.createElement("div",{className:"h-100"},c.a.createElement("div",{className:"container section"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-sm-12"},c.a.createElement("div",{className:"text-center my-4 p-4 bg-white rounded shadow-sm"},c.a.createElement("div",{className:"sk-circle"},c.a.createElement("div",{className:"sk-circle1 sk-child"}),c.a.createElement("div",{className:"sk-circle2 sk-child"}),c.a.createElement("div",{className:"sk-circle3 sk-child"}),c.a.createElement("div",{className:"sk-circle4 sk-child"}),c.a.createElement("div",{className:"sk-circle5 sk-child"}),c.a.createElement("div",{className:"sk-circle6 sk-child"}),c.a.createElement("div",{className:"sk-circle7 sk-child"}),c.a.createElement("div",{className:"sk-circle8 sk-child"}),c.a.createElement("div",{className:"sk-circle9 sk-child"}),c.a.createElement("div",{className:"sk-circle10 sk-child"}),c.a.createElement("div",{className:"sk-circle11 sk-child"}),c.a.createElement("div",{className:"sk-circle12 sk-child"})),c.a.createElement("h3",null,c.a.createElement("i",{className:"fa fa-phone","aria-hidden":"true"})," ",this.getPhone()||"Inimene"),c.a.createElement("h6",{className:"text-secondary mb-4"},"pole veel linki avanud"),c.a.createElement("button",{className:"btn btn-primary btn-back",onClick:this.goBack},"Tagasi"))))))}}]),t}(n.Component),z=Object(h.a)(f(V)),R=f(function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,c=new Array(n),i=0;i<n;i++)c[i]=arguments[i];return(a=Object(r.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(c)))).handleSelectedFile=function(e){var t=e.target.files[0],n=a.props,c=n.firebase,i=n.match.params.id,l=c.storage(),s=S()(),o=l.ref().child(s),r=1,m=1;if(t){var d=new Image;d.src=window.URL.createObjectURL(t),d.onload=function(){r=d.naturalWidth,m=d.naturalHeight,window.URL.revokeObjectURL(d.src)}}o.put(t).then(function(e){console.log("Saved file"),e.ref.getDownloadURL().then(function(e){console.log(e),c.firestore().collection("events").doc(i).collection("images").doc(s).set({width:r,height:m,src:e})})})},a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.firebase,a=e.match.params.id;t.firestore().collection("events").doc(a).set({startTime:Date()},{merge:!0}),this.locate()}},{key:"locate",value:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){console.log(e)},console.log):console.log("Error");var e=this.props.match.params.id;this.props.firebase.firestore().collection("events").doc(e).set({location:new b.firestore.GeoPoint(59.438698,24.729117),address:"Telliskivi 60a, Tallinn"},{merge:!0})}},{key:"render",value:function(){return c.a.createElement("div",{className:"login-page"},c.a.createElement("div",{className:"container pt-5"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-10 offset-lg-1 col-sm-12 offset-sm-0 text-center"},c.a.createElement("div",{className:"col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-sm-12"},c.a.createElement("div",{className:"row mt-4 pt-4 pb-4 justify-content-center login-form"},c.a.createElement("div",{className:"col-lg-9"},c.a.createElement("h3",{className:"mt-2 mb-4 pb-2"},c.a.createElement("span",null,"H\xe4irekeskuse Pildipank")),c.a.createElement("form",null,c.a.createElement("div",{className:"form-group"},c.a.createElement("label",{style:{width:"100%"}},c.a.createElement("input",{style:{display:"none"},type:"file",onChange:this.handleSelectedFile}),c.a.createElement("span",{className:"btn btn-primary btn-block btn-lg"},"LISA PILT")))),c.a.createElement("div",{className:"login-form__break mt-3 mb-3"},c.a.createElement("span",{className:"ml-2 mr-2"},c.a.createElement("span",null,"v\xf5i"))),c.a.createElement("div",null,c.a.createElement(C,null))),c.a.createElement("div",{className:"col-lg-9 mt-4"},c.a.createElement("span",null,"Pildi ning videomaterjal on vajalik h\xe4daolukorrale operatiivseks reageerimiseks."))))))))}}]),t}(c.a.Component)),A=a(64),F=a(30),W=a(65),_=(a(158),function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(r.a)(this,Object(m.a)(t).call(this,e))).state={value:""},a.handleChange=a.handleChange.bind(Object(u.a)(Object(u.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(Object(u.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"createEvent",value:function(){var e=S()();this.props.firebase.firestore().collection("events").doc(e).set({phoneNr:this.state.value});return e}},{key:"sendSms",value:function(){var e=this.createEvent(),t="H\xe4irekeskus palub teil s\xfcndmusest pilte teha. https://pipa.ee/%23/upload/".concat(e);return fetch("https://nodejs-k5z130dub.now.sh?to=".concat(this.state.value,"&message=").concat(t)).then(function(e){return console.log(e.body)}).catch(function(e){return console.log(e)}),e}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this.sendSms();this.props.history.push("/event/".concat(t)),e.preventDefault()}},{key:"render",value:function(){return c.a.createElement("section",{className:"home h-100",id:"home"},c.a.createElement("div",{className:"container h-100"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-lg-12"},c.a.createElement("div",{className:"home-wrapper text-center"},c.a.createElement("h1",{className:"animated fadeInDown wow","data-wow-delay":".1s"},"H\xe4irekeskuse ",c.a.createElement("span",{className:"text-colored"},"pildipank")," ","ehk ",c.a.createElement("span",{className:"text-colored"},"pipa"),".ee"),c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-sm-10 offset-sm-1"},c.a.createElement("p",{className:"animated fadeInDown wow text-muted","data-wow-delay":".2s"},"Sisesta siia inimese ",c.a.createElement("strong",null,"mobiilinumber")," ja saada talle s\xf5numiga link,",c.a.createElement("br",null),"kuhu ta saab laadida pilte ja videoklippe."))),c.a.createElement("div",{className:"text-center subscribe-form"},c.a.createElement("form",{onSubmit:this.handleSubmit},c.a.createElement("input",{type:"text",placeholder:"5555555",onChange:this.handleChange}),c.a.createElement("button",{type:"submit"},"Saada"))),c.a.createElement("div",{className:"clearfix"}))))),c.a.createElement("a",{href:"https://producement.com",className:"text-center"},c.a.createElement("img",{className:"navbar-brand logo floating",src:H.a,alt:"Producement.com"})))}}]),t}(c.a.Component)),G=Object(W.a)(f(_)),J=f(function(e){function t(){return Object(s.a)(this,t),Object(r.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return c.a.createElement(A.a,null,c.a.createElement("div",{className:"h-100"},c.a.createElement(F.a,{exact:!0,path:"/",component:G}),c.a.createElement(F.a,{path:"/event/:id",component:z}),c.a.createElement(F.a,{path:"/upload/:id",component:R})))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(160),a(162),a(164);l.a.render(c.a.createElement(g.Provider,{value:new k},c.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},34:function(e,t,a){e.exports=a.p+"static/media/bull.2d70f963.svg"},70:function(e,t,a){e.exports=a.p+"static/media/tonu.5afbd925.png"},72:function(e,t,a){e.exports=a(166)}},[[72,2,1]]]);
//# sourceMappingURL=main.67b8eb69.chunk.js.map